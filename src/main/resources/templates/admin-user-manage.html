<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>Admin-회원 관리</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css">

</head>
<body>

<aside class="my-info">
  <div class="user-nickname" th:text="|회원 닉네임: ${userNickname}|"></div>
  <div class="user-level-name" th:text="|회원 등급: ${userLevelName}|"></div>
  <button class="logout-btn" th:onclick="logout()">로그 아웃</button>
  <button class="account-delete-btn" th:onclick="goToFreeBoard()">자유 게시판</button>
</aside>

<section class="search-user">
  <input type="text" placeholder="닉네임을 입력해주세요" class="search">
  <button class="search-btn" onclick="searchUser()"> 검색 </button>
</section>
<section class="change-orderBy-sort">
  <select name="정렬기준" class="order-by" onchange="changeOrder(this.value)">
    <option value="none"> == 정렬 기준 == </option>
    <option value="userId"> 기본 </option>
    <option value="nickname"> 닉네임 </option>
    <option value="level"> 등급 </option>
    <option value="currentPostCount"> 총 게시글 수 </option>
  </select>

  <select name="정렬방식" class="sort" onchange="changeSort(this.value)">
    <option value="none"> == 정렬 방식 == </option>
    <option value="asc"> 오름차순 </option>
    <option value="desc"> 내림차순 </option>
  </select>

</section>
<section class="user-info-table">
  <table>
    <thead>
    <tr>
      <th>No.</th>
      <th>닉네임</th>
      <th>등급</th>
      <th>총 게시글 수</th>
      <th>등급 변경</th>
      <th>가입 제한 설정</th>
    </tr>
    </thead>
    <tbody th:with="currentPage = (__${request.getParameter('page')}__ == null ? 1 : __${request.getParameter('page')}__)">
      <tr th:if="${#lists.isEmpty(userList)}">
        <td colspan="6">회원 정보가 존재하지 않습니다.</td>
      </tr>
      <tr th:if="${not #lists.isEmpty(userList)}" th:each="user, stat : ${userList}">
        <td><span th:text="(${currentPage} - 1) * 10 + ${stat.index} + 1"> No. </span></td>
        <td><span th:text="${user.nickname}"> 닉네임</span></td>
        <td><span th:text="${user.levelName}"> 등급 </span></td>
        <td><span th:text="${user.currentPostCount}"> 총 게시글 수 </span></td>
        <td>
          <select name="등급" class="select-level" th:onchange="|changeUserLevel('${user.userId}', this.value)|">
            <option value="none"> == 등급 변경 ==</option>
            <option value="1"> Tier 1</option>
            <option value="2"> Tier 2</option>
            <option value="3"> Tier 3</option>
            <option value="4"> Tier 4</option>
            <option value="5"> Tier 5</option>
          </select>
        </td>
        <td>
          <button class="user-block-btn" th:if="${not #sets.contains(blockedUserSet, user.userId)}"
                  th:onclick="|setUserBlock('${user.userId}')|"> 가입 제한
          </button>
          <button class="user-unblock-btn" th:if="${#sets.contains(blockedUserSet, user.userId)}"
                  th:onclick="|setUserUnblock('${user.userId}')|"> 가입 제한 해제
          </button>
        </td>
      </tr>

    </tbody>
  </table>
</section>
<section class="page">
  <a th:if="${request.getParameter('nickname') != null}" href="http://localhost:8080/admin/user/management">뒤로 가기</a>

  <ul th:if="${request.getParameter('nickname') == null}"
      th:with="orderby = (__${request.getParameter('orderby')}__ == null ? 'userId' : __${request.getParameter('orderby')}__),
               sort = (__${request.getParameter('sort')}__ == null ? 'asc' : __${request.getParameter('sort')}__)">
    <li th:each="page : ${#numbers.sequence(__${currentStartPage}__, __${currentLastPage}__)}">
      <a th:href="@{__${request.getRequestURL()}__?page=__${page}__&orderby=__${orderby}__&sort=__${sort}__}" th:text="__${page}__"></a>
    </li>
  </ul>
</section>
</body>
<script th:inline="javascript" src="/admin-user-management.js"></script>
<script th:inline="javascript" src="/myInfoFunctions.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.1/jquery.min.js"></script>
</html>